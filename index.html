
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#makerjs" class="toc-h1 toc-link" data-title="makerjs">MakerJS</a>
          </li>
          <li>
            <a href="#package-setup" class="toc-h1 toc-link" data-title="package-setup">Package Setup</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#npm" class="toc-h2 toc-link" data-title="npm">NPM</a>
                  </li>
                  <li>
                    <a href="#umd" class="toc-h2 toc-link" data-title="umd">UMD</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="getting-started">Getting Started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#config-factory" class="toc-h2 toc-link" data-title="config-factory">Config Factory</a>
                  </li>
                  <li>
                    <a href="#instantiation" class="toc-h2 toc-link" data-title="instantiation">Instantiation</a>
                  </li>
                  <li>
                    <a href="#example" class="toc-h2 toc-link" data-title="example">Example</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#maker" class="toc-h1 toc-link" data-title="maker">Maker</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#service" class="toc-h2 toc-link" data-title="strong-service-strong"><strong>service</strong></a>
                  </li>
                  <li>
                    <a href="#opencdp" class="toc-h2 toc-link" data-title="strong-opencdp-strong"><strong>openCdp</strong></a>
                  </li>
                  <li>
                    <a href="#getcdp" class="toc-h2 toc-link" data-title="strong-getcdp-strong"><strong>getCdp</strong></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cdp" class="toc-h1 toc-link" data-title="cdp">CDP</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getcdpid" class="toc-h2 toc-link" data-title="strong-getcdpid-strong"><strong>getCdpId</strong></a>
                  </li>
                  <li>
                    <a href="#getinfo" class="toc-h2 toc-link" data-title="strong-getinfo-strong"><strong>getInfo</strong></a>
                  </li>
                  <li>
                    <a href="#getcollateralamount" class="toc-h2 toc-link" data-title="strong-getcollateralamount-strong"><strong>getCollateralAmount</strong></a>
                  </li>
                  <li>
                    <a href="#getdebtamount" class="toc-h2 toc-link" data-title="strong-getdebtamount-strong"><strong>getDebtAmount</strong></a>
                  </li>
                  <li>
                    <a href="#locketh" class="toc-h2 toc-link" data-title="strong-locketh-strong"><strong>lockEth</strong></a>
                  </li>
                  <li>
                    <a href="#drawdai" class="toc-h2 toc-link" data-title="strong-drawdai-strong"><strong>drawDai</strong></a>
                  </li>
                  <li>
                    <a href="#wipedai" class="toc-h2 toc-link" data-title="strong-wipedai-strong"><strong>wipeDai</strong></a>
                  </li>
                  <li>
                    <a href="#freepeth" class="toc-h2 toc-link" data-title="strong-freepeth-strong"><strong>freePeth</strong></a>
                  </li>
                  <li>
                    <a href="#give" class="toc-h2 toc-link" data-title="strong-give-strong"><strong>give</strong></a>
                  </li>
                  <li>
                    <a href="#shut" class="toc-h2 toc-link" data-title="strong-shut-strong"><strong>shut</strong></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#price-feed-service" class="toc-h1 toc-link" data-title="price-feed-service">Price Feed Service</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getethprice" class="toc-h2 toc-link" data-title="getethprice">getEthPrice</a>
                  </li>
                  <li>
                    <a href="#getmkrprice" class="toc-h2 toc-link" data-title="getmkrprice">getMkrPrice</a>
                  </li>
                  <li>
                    <a href="#setethprice" class="toc-h2 toc-link" data-title="setethprice">setEthPrice</a>
                  </li>
                  <li>
                    <a href="#setmkrprice" class="toc-h2 toc-link" data-title="setmkrprice">setMkrPrice</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#exchange-service" class="toc-h1 toc-link" data-title="exchange-service">Exchange Service</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#selldai" class="toc-h2 toc-link" data-title="selldai">sellDai</a>
                  </li>
                  <li>
                    <a href="#buydai" class="toc-h2 toc-link" data-title="buydai">buyDai</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#custom-config-files" class="toc-h1 toc-link" data-title="custom-config-files">Custom Config Files</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#web3service-settings" class="toc-h2 toc-link" data-title="strong-web3service-settings-strong"><strong>Web3Service Settings</strong></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#source-code-setup" class="toc-h1 toc-link" data-title="source-code-setup">Source Code Setup</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#prerequisites" class="toc-h2 toc-link" data-title="prerequisites">Prerequisites</a>
                  </li>
                  <li>
                    <a href="#features" class="toc-h2 toc-link" data-title="features">Features</a>
                  </li>
                  <li>
                    <a href="#run-the-tests" class="toc-h2 toc-link" data-title="run-the-tests">Run the tests</a>
                  </li>
                  <li>
                    <a href="#inspect-contract-state" class="toc-h2 toc-link" data-title="inspect-contract-state">Inspect contract state</a>
                  </li>
                  <li>
                    <a href="#commands" class="toc-h2 toc-link" data-title="commands">Commands</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='makerjs'>MakerJS</h1>
<p><a href="https://travis-ci.org/jluccisano/webpack-es6-boilerplate"><img src="http://img.shields.io/travis/jluccisano/webpack-es6-boilerplate.svg" alt="tests" /></a>
<a href="https://codecov.io/gh/jluccisano/webpack-es6-boilerplate"><img src="https://codecov.io/gh/jluccisano/webpack-es6-boilerplate/branch/master/graph/badge.svg" alt="coverage" /></a></p>

<p><strong>MakerJS</strong> is a JavaScript library that makes it easy to build applications on top of MakerDAO&#39;s platform of smart contracts. You can use Maker&#39;s contracts to open Collateralized Debt Positions, withdraw loans in Dai, trade tokens on OasisDEX, and more.</p>

<p>The library features a pluggable, service-based architecture, which allows users maximal control when integrating the Maker functionality into existing infrastructures. It also includes convenient configuration presets for out-of-the-box usability, a powerful smart contract state inspector, and support for both front-end and back-end applications.</p>

<p>Maker&#39;s entire suite of contracts will eventually be accessible through this library—including the DAO governance and the upcoming multi-collateral release—but functionality is limited in the current alpha version to the following areas:</p>

<ul>
<li>Opening and shutting CDPs</li>
<li>Locking and unlocking collateral</li>
<li>Withdrawing and repaying Dai</li>
<li>Automated token conversions</li>
<li>Token contract functionality for WETH, PETH, MKR, Dai, and ETH</li>
<li>Buying and selling MKR and Dai with built-in DEX integration</li>
</ul>
<h1 id='package-setup'>Package Setup</h1><h2 id='npm'>NPM</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="p">{</span>
  <span class="nx">Maker</span><span class="p">,</span>
  <span class="nx">ConfigFactory</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">'@makerdao/makerdao-exchange-integration'</span><span class="p">;</span>

<span class="c1">// OR</span>

<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">Maker</span><span class="p">,</span>
  <span class="nx">ConfigFactory</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'@makerdao/makerdao-exchange-integration'</span><span class="p">)</span>
</code></pre>
<p>The easiest way to install this package is with npm:</p>

<p><code>$ npm install @makerdao/makerdao-exchange-integration</code></p>

<p>Alternatively, this can be done using yarn:</p>

<p><code>$ yarn add @makerdao/makerdao-exchange-integration</code></p>

<p>Once installed, import the necessary modules into your project using import or require.</p>
<h2 id='umd'>UMD</h2><pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./maker-exchange-integration.js"</span> <span class="nt">/&gt;</span>

<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span> 
<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">ConfigFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'decentralized-oasis-without-proxies'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">maker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Maker</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

<span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">cdp</span> <span class="o">=&gt;</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getInfo</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">info</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">info</span><span class="p">));</span> 
<span class="nt">&lt;/script&gt;</span>
</code></pre>
<p>This library is also accessible via a <a href="https://github.com/umdjs/umd">UMD module</a>.</p>
<h1 id='getting-started'>Getting Started</h1><h3 id='config-factory'>Config Factory</h3>
<p>When instantiating a <code>Maker</code> object, you must pass in a configuration preset.</p>

<p>The current presets are as follows:</p>

<ul>
<li><code>&#39;kovan&#39;</code>

<ul>
<li>Connects you to the Kovan Testnet using Infura</li>
<li>Signs transactions using a private key that you provide</li>
</ul></li>
<li><code>&#39;decentralized-oasis-without-proxies&#39;</code>

<ul>
<li>Connects you to a local testnet (eg Ganache) running at <code>http://127.1:2000</code></li>
<li>Signs transactions using testnet-managed keys</li>
</ul></li>
</ul>

<p><em>Note: refer to the <code>Custom Config Files</code> section further down for details on customizing the config file</em></p>

<p><em>Side Note: Proxies are contracts that will let you perform multiple actions with a single transaction (eg <code>open</code> -&gt; <code>lock</code> -&gt; <code>draw</code>). This is a safer way to perform sequential actions and will be supported by this library.</em></p>
<h3 id='instantiation'>Instantiation</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Maker</span><span class="p">(</span><span class="s2">"kovan"</span><span class="p">,</span> <span class="p">{</span> <span class="na">privateKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">KOVAN_PRIVATE_KEY</span> <span class="p">});</span>

  <span class="kr">const</span> <span class="nx">cdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span>
</code></pre>
<p>Gain access to the top-level API by creating a connected instance of the Maker class. </p>

<p><code>new Maker(config)</code></p>

<p>Use that class to open a cdp and create a cdp object.</p>

<p><code>maker.openCdp()</code></p>
<h2 id='example'>Example</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Maker</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@makerdao/makerdao-exchange-integration'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Maker</span><span class="p">(</span><span class="s2">"kovan"</span><span class="p">,</span> <span class="p">{</span> <span class="na">privateKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">KOVAN_PRIVATE_KEY</span> <span class="p">});</span>

<span class="nx">async</span> <span class="nx">openLockDraw</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span>

  <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="s1">'0.25'</span><span class="p">);</span>
  <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">drawDai</span><span class="p">(</span><span class="s1">'50'</span><span class="p">);</span>


  <span class="kr">const</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getInfo</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">info</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">openLockDraw</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
<p>Using the <code>maker</code> and <code>cdp</code> APIs, the program shown on the right opens a cdp, locks 0.25 ETH into it, draws out 50 Dai, and then logs information about our newly opened position to the console.</p>
<h1 id='maker'>Maker</h1>
<p>Once you&#39;ve connected your instance of <code>maker</code> (following the instructions in the <code>Web3Service</code> section), you can use the <code>maker</code> interface to access the core library functionality.</p>
<h2 id='service'><strong>service</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">priceFeedService</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'priceFeed'</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> service (string)</li>
<li><strong>Returns:</strong> service object</li>
</ul>

<p>The service function can be used to access services that were injected into your instance of <code>maker</code>. The service must be in the list of available services you passed to <code>ConfigFactory</code>.</p>

<p><em>Note: see the <code>Custom Config Files</code> section further down for an example config file with a list of services</em></p>
<h2 id='opencdp'><strong>openCdp</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">newCdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to new CDP object)</li>
</ul>

<p><code>maker.openCdp()</code> will create a new CDP, and then return the CDP object, which can be used to access other CDP functionality.</p>

<p>By default, the promise will resolve when the transaction is mined.</p>
<h2 id='getcdp'><strong>getCdp</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">cdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">getCdp</span><span class="p">(</span><span class="mi">614</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> CDP ID (integer)</li>
<li><strong>Returns:</strong> promise (resolves to CDP object)</li>
</ul>

<p><code>maker.getCdp(id)</code> creates a CDP object for an existing CDP. The CDP object can then be used to interact with your CDP.</p>
<h1 id='cdp'>CDP</h1>
<p>Now that you&#39;ve used <code>maker</code> to either open a new CDP or retrieve an existing one, you can use the returned <code>cdp</code> object to call functions on it.</p>
<h2 id='getcdpid'><strong>getCdpId</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getCdpId</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to CDP ID)</li>
</ul>

<p>Use <code>cdp.getCdpId()</code> to retrieve the ID from a CDP object. You may need to use the ID as a parameter for other functions.</p>
<h2 id='getinfo'><strong>getInfo</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getInfo</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">lockedPeth</span> <span class="o">=</span> <span class="nx">info</span><span class="p">.</span><span class="nx">ink</span><span class="p">;</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to CDP info object)</li>
</ul>

<p><code>cdp.getInfo()</code> will return a few distinct properties of the CDP:</p>

<ul>
<li>lad: The Ethereum address associated with the owner of the CDP</li>
<li>ink: Amount of collateral locked in the CDP</li>
<li>art: Outstanding normalized debt (tax only)</li>
<li>ire: Outstanding normalized debt</li>
</ul>

<p>Please refer to the <a href="https://makerdao.com/whitepaper/DaiDec17WP.pdf">MakerDAO White Paper</a> or reach out on our <a href="https://chat.makerdao.com/home">community chat</a> if you need help understanding how these variables are used in the system.</p>
<h2 id='getcollateralamount'><strong>getCollateralAmount</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">lockedPeth</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getCollateralAmount</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to locked amount in PETH)</li>
</ul>

<p><code>cdp.getCollateralAmount()</code> returns the amount of locked collateral in the CDP.</p>
<h2 id='getdebtamount'><strong>getDebtAmount</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">daiDebt</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getDebtAmount</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to the amount of outstanding debt in Dai)</li>
</ul>

<p><code>cdp.getDebtAmount()</code> returns the amount of Dai that has been borrowed against the collateral in the CDP.</p>
<h2 id='locketh'><strong>lockEth</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="s1">'0.1'</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> amount to lock in the CDP (in ETH, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.lockEth(eth)</code> abstracts the token conversions needed to lock collateral in a CDP. It first converts the ETH to WETH, then converts the WETH to PETH, then locks the PETH in the CDP.</p>
<h2 id='drawdai'><strong>drawDai</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">drawDai</span><span class="p">(</span><span class="s1">'100'</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> amount to draw (in Dai, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.drawDai(dai)</code> withdraws the specified amount of Dai as a loan against the collateral in the CDP. As such, it will fail if the CDP doesn&#39;t have enough PETH locked in it to remain at least 150% collateralized.</p>
<h2 id='wipedai'><strong>wipeDai</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">wipeDai</span><span class="p">(</span><span class="s1">'100'</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> amount to repay (in Dai, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.wipeDai(dai)</code> sends Dai back to the CDP in order to repay some (or all) of its outstanding debt.</p>

<p><em>Note: CDPs accumulate MKR governance debt over their lifetime. This must be paid when wiping dai debt, and thus MKR must be acquired before calling this method.</em></p>
<h2 id='freepeth'><strong>freePeth</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">freePeth</span><span class="p">(</span><span class="s1">'0.1'</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> amount to withdraw (in PETH, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.freePeth(peth)</code> withdraws the specified amount of PETH and returns it to the owner&#39;s address. As such, the contract will only allow you to free PETH that&#39;s locked in excess of 150% of the CDP&#39;s outstanding debt.</p>
<h2 id='give'><strong>give</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">give</span><span class="p">(</span><span class="s1">'0x046ce6b8ecb159645d3a605051ee37ba93b6efcc'</span><span class="p">);</span>
</code></pre>
<ul>
<li><strong>Params:</strong> Ethereum address (string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.give(address)</code> transfers ownership of the CDP from the current owner to the address you provide as an argument.</p>
<h2 id='shut'><strong>shut</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">shut</span><span class="p">();</span>
</code></pre>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.shut()</code> will close the CDP and return the collateral, in PETH, to its owner. It will fail if the CDP still has outstanding debt.</p>
<h1 id='price-feed-service'>Price Feed Service</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">priceFeed</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'priceFeed'</span><span class="p">);</span>
</code></pre>
<p>Retrieve the PriceFeedService through <code>Maker.service(&#39;priceFeed&#39;)</code>.</p>

<p>The PriceFeedService exposes the collateral and governance tokens price information that is 
reported by the oracles in the Maker system.</p>
<h2 id='getethprice'>getEthPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">priceFeed</span><span class="p">.</span><span class="nx">getEthPrice</span><span class="p">();</span>
</code></pre>
<p>Get the current USD price of ETH.</p>
<h2 id='getmkrprice'>getMkrPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">priceFeed</span><span class="p">.</span><span class="nx">getMkrPrice</span><span class="p">();</span>
</code></pre>
<p>Get the current USD price of the governance token MKR.</p>
<h2 id='setethprice'>setEthPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">priceFeed</span><span class="p">.</span><span class="nx">setEthPrice</span><span class="p">(</span><span class="s1">'475.00'</span><span class="p">);</span>
</code></pre>
<p>Set the current USD price of ETH. </p>

<p>This requires the necessary permissions and will only be useful in a testing environment.</p>
<h2 id='setmkrprice'>setMkrPrice</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">priceFeed</span><span class="p">.</span><span class="nx">setMkrPrice</span><span class="p">(</span><span class="s1">'950.00'</span><span class="p">);</span>
</code></pre>
<p>Set the current USD price of the governance token MKR. </p>

<p>This requires the necessary permissions and will only be useful in a testing environment.</p>
<h1 id='exchange-service'>Exchange Service</h1><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">exchange</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'exchange'</span><span class="p">);</span>
</code></pre>
<p>Retrieve the OasisExchangeService (or alternative implementation) 
through <code>Maker.service(&#39;exchange&#39;)</code>.</p>

<p>The exchange service allows to buy and sell DAI, MKR, and other tokens. The default 
OasisExchangeService implementation uses the OasisDEX OTC market for this. </p>
<h2 id='selldai'>sellDai</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// Sell 100.00 DAI for 0.30 WETH or more.</span>
<span class="kr">const</span> <span class="nx">sellOrder</span> <span class="o">=</span> <span class="nx">exchange</span><span class="p">.</span><span class="nx">sellDai</span><span class="p">(</span><span class="s1">'100.0'</span><span class="p">,</span> <span class="s1">'WETH'</span><span class="p">,</span> <span class="s1">'0.30'</span><span class="p">);</span>
</code></pre>
<p>Sell a set amount of DAI and receive another token in return.</p>
<h3 id='parameters'>Parameters</h3>
<ul>
<li><code>daiAmount</code> - Amount of DAI to sell.</li>
<li><code>tokenSymbol</code> - Token to receive in return.</li>
<li><code>minFillAmount</code> - Minimum amount to receive in return.</li>
</ul>
<h2 id='buydai'>buyDai</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// Buy 100.00 DAI for 0.30 WETH or less.</span>
<span class="kr">const</span> <span class="nx">buyOrder</span> <span class="o">=</span> <span class="nx">exchange</span><span class="p">.</span><span class="nx">buyDai</span><span class="p">(</span><span class="s1">'100.0'</span><span class="p">,</span> <span class="s1">'WETH'</span><span class="p">,</span> <span class="s1">'0.35'</span><span class="p">);</span>
</code></pre>
<p>Buy a set amount of DAI and give another token in return.</p>
<h3 id='parameters-2'>Parameters</h3>
<ul>
<li><code>daiAmount</code> - Amount of DAI to buy.</li>
<li><code>tokenSymbol</code> - Token to give in return.</li>
<li><code>minFillAmount</code> - Maximum amount to give in return.</li>
</ul>
<h1 id='custom-config-files'>Custom Config Files</h1><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="s2">"global"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"enableProxies"</span><span class="p">:</span> <span class="kc">false</span>
  <span class="p">},</span>

  <span class="s2">"services"</span><span class="p">:</span> <span class="p">{</span>

    <span class="s2">"web3"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"Web3Service"</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="s2">"usePresetProvider"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">"provider"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"INFURA"</span><span class="p">,</span>
          <span class="s2">"network"</span><span class="p">:</span> <span class="s2">"kovan"</span>
          <span class="s2">"infuraApiKey"</span><span class="p">:</span> <span class="s1">'ab...yz'</span>
        <span class="p">},</span>
        <span class="s2">"privateKey"</span><span class="p">:</span> <span class="s2">"0x..."</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">"allowance"</span><span class="p">:</span> <span class="s2">"AllowanceService"</span><span class="p">,</span>
    <span class="s2">"cdp"</span><span class="p">:</span> <span class="s2">"EthereumCdpService"</span><span class="p">,</span>
    <span class="s2">"exchange"</span><span class="p">:</span> <span class="s2">"OasisExchangeService"</span><span class="p">,</span>
    <span class="s2">"smartContract"</span><span class="p">:</span> <span class="s2">"SmartContractService"</span><span class="p">,</span>
    <span class="s2">"token"</span><span class="p">:</span> <span class="s2">"EthereumTokenService"</span><span class="p">,</span>
    <span class="s2">"conversionService"</span><span class="p">:</span> <span class="s2">"TokenConversionService"</span><span class="p">,</span>
    <span class="s2">"gasEstimator"</span><span class="p">:</span> <span class="s2">"GasEstimatorService"</span><span class="p">,</span>
    <span class="s2">"transactionManager"</span><span class="p">:</span> <span class="s2">"TransactionManager"</span><span class="p">,</span>
    <span class="s2">"priceFeed"</span><span class="p">:</span> <span class="s2">"PriceFeedService"</span><span class="p">,</span>

    <span class="s2">"timer"</span><span class="p">:</span> <span class="s2">"TimerService"</span><span class="p">,</span>
    <span class="s2">"log"</span><span class="p">:</span> <span class="s2">"ConsoleLogger"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>When creating a new Maker object, a Config file is passed in. Here is the config file created by ConfigFactory.create(&#39;kovan&#39;)</p>

<p>Config files allow for mixing and matching of different implementations of services used by the library.</p>

<p>They also allow users to pass in settings to certain services.</p>
<h2 id='web3service-settings'><strong>Web3Service Settings</strong></h2><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
    <span class="s2">"usePresetProvider"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">"provider"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"INFURA"</span><span class="p">,</span>
      <span class="s2">"network"</span><span class="p">:</span> <span class="s2">"kovan"</span>
      <span class="s2">"infuraApiKey"</span><span class="p">:</span> <span class="s1">'ab...yz'</span>
    <span class="p">},</span>
    <span class="s2">"privateKey"</span><span class="p">:</span> <span class="s2">"0x..."</span>
 <span class="p">}</span>
</code></pre>
<p>A common service to pass in settings to is the Web3Service, which controls</p>

<ol>
<li>How the library connects to an ethereum node</li>
<li>Which private keys the library has access to</li>
</ol>

<p>For example, these are the Web3Service settings for the &quot;kovan&quot; config file from above</p>

<p>Below are the different options that can be passed in to the Web3Service settings</p>
<h3 id='usepresetprovider'><strong>usePresetProvider</strong></h3><pre class="highlight javascript tab-javascript"><code><span class="s2">"usePresetProvider"</span><span class="p">:</span> <span class="kc">true</span>
</code></pre>
<p>if marked true, the object obtained from <code>window.web3</code> (if there is one) will be used as the Provider, instead of creating a new one. For example, this should be true if the library is used in a browser and it should use metamask as its Web3Provider.</p>

<p>Default value: false.</p>
<h3 id='statustimerdelay'><strong>statusTimerDelay</strong></h3><pre class="highlight javascript tab-javascript"><code><span class="s2">"statusTimerDelay"</span><span class="p">:</span> <span class="mi">2000</span>

</code></pre>
<p>Number in milliseconds that represents how often the blockchain connection and account authentication is checked. This allows the library to move out of an authenticated or connected state when it discovers it no longer has access to unlocked accounts, or can no longer connect to a node.</p>

<p>default value: 5000 (5 seconds)</p>
<h3 id='privatekey'><strong>privateKey</strong></h3><pre class="highlight javascript tab-javascript"><code><span class="nx">privateKey</span><span class="p">:</span> <span class="s2">"0x..."</span>

</code></pre>
<p>private key used to sign all transactions.  If not provided, the first account available from the ethereum node will be used to sign transaction.</p>
<h3 id='provider-type'><strong>Provider Type</strong></h3><pre class="highlight javascript tab-javascript"><code><span class="s2">"provider"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"HTTP"</span>
  <span class="p">}</span>
</code></pre>
<p>&quot;INFURA&quot;: connect to an ethereum node via infura</p>

<p>&quot;TEST&quot;: connect to a local test blockchain at &#39;http://127.1:2000&#39;</p>

<p>&quot;HTTP&quot;: connect to an ethereum node via any arbitrary url</p>
<h3 id='provider-network'><strong>Provider Network</strong></h3><pre class="highlight javascript tab-javascript"><code><span class="s2">"provider"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"network"</span><span class="p">:</span> <span class="s2">"kovan"</span>
  <span class="p">}</span>
</code></pre>
<p>Name of ethereum network to use when using the &quot;INFURA&quot; provider type.  The Maker smart contracts are only deployed on mainnet and kovan (not ropsten or rinkeby)</p>

<p>options: &quot;mainnet&quot; | &quot;kovan&quot;</p>
<h3 id='provider-url'><strong>Provider URL</strong></h3><pre class="highlight javascript tab-javascript"><code><span class="s2">"provider"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="s2">"HTTP"</span>
    <span class="nl">url</span><span class="p">:</span> <span class="s1">'https://sai-service.makerdao.com/node'</span>
  <span class="p">}</span>

</code></pre>
<p>url of node to connect.  Only used when using &quot;HTTP&quot; provider type.</p>
<h3 id='infura-api-key'><strong>Infura API Key</strong></h3><pre class="highlight javascript tab-javascript"><code><span class="s2">"provider"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="s2">"INFURA"</span>
    <span class="nl">infuraApiKey</span><span class="p">:</span> <span class="s1">'ab...yz'</span>
  <span class="p">}</span>

</code></pre>
<p>String value of your Infura unique Access Token (the part after infura.io/ when accessing infura via https)</p>
<h3 id='default-web3service-settings'><strong>Default Web3Service Settings</strong></h3><pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="nl">usePresetProvider</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">provider</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="s2">"HTTP"</span><span class="p">,</span>
    <span class="nx">url</span><span class="p">:</span> <span class="s1">'https://sai-service.makerdao.com/node'</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
<p>if no settings are passed in to the Web3Service in the config json file, the default settings are used.  It connects to a node run by the Maker team at &quot;https://sai-service.makerdao.com/node&quot;</p>
<h1 id='source-code-setup'>Source Code Setup</h1>
<ol>
<li><code>git clone https://github.com/makerdao/makerdao-integration-poc</code></li>
<li><code>npm install</code></li>
</ol>
<h2 id='prerequisites'>Prerequisites</h2>
<p><a href="https://nodejs.org"><img src="https://img.shields.io/node/v/webpack-es6-boilerplate.svg" alt="node" /></a>
<a href="https://npmjs.com/"><img src="https://img.shields.io/badge/npm-5.3.0-blue.svg" alt="npm" /></a></p>

<ul>
<li><a href="http://es6-features.org">Node.js</a></li>
</ul>
<h2 id='features'>Features</h2>
<ul>
<li><a href="https://webpack.js.org/guides">Webpack</a> (v3.5.5)

<ul>
<li><a href="https://github.com/webpack/webpack-dev-server">Webpack Dev Server</a> (v2.7.1)</li>
<li><a href="https://webpack.js.org/concepts/hot-module-replacement">Hot Module Replacement</a></li>
<li><a href="https://github.com/johnagan/clean-webpack-plugin">Clean Webpack Plugin</a> (v0.1.16)</li>
</ul></li>
<li><a href="http://es6-features.org">ECMAScript 6</a></li>
<li><a href="https://babeljs.io/docs/setup/#installation">Babel</a> (v6.26.0)</li>
<li><a href="https://eslint.org/docs/user-guide/getting-started">ESLint</a> (v4.5.0)</li>
<li><a href="https://facebook.github.io/jest/docs/en/getting-started.html">Jest</a> (v20.0.4)</li>
<li><a href="http://sass-lang.com/guide">Sass</a></li>
</ul>
<h2 id='run-the-tests'>Run the tests</h2>
<p>The test suite is configured to run on a Ganache test chain. Before running the tests (<code>npm test</code>), the test chain will start, and the script will deploy all the Maker contracts to the chain.</p>

<p>To avoid waiting for this process every time you run the tests, use the command <code>npm run test:watch</code>.</p>

<p>If you want to deploy the contracts to a test chain independently from the test suite, use <code>npm run test:net</code>.</p>
<h2 id='inspect-contract-state'>Inspect contract state</h2>
<p>Start the dev server using <code>npm start</code>, then open <a href="http://localhost:9000">http://localhost:9000</a></p>
<h2 id='commands'>Commands</h2>
<ul>
<li><code>npm start</code> - start the dev server</li>
<li><code>npm run build:backend</code> - create backend build in <code>dist</code> folder</li>
<li><code>npm run build:frontend</code> - create frontend build in <code>dist</code> folder</li>
<li><code>npm run lint</code> - run an ESLint check</li>
<li><code>npm run coverage</code> - run code coverage and generate report in the <code>coverage</code> folder</li>
<li><code>npm test</code> - run all tests</li>
<li><code>npm run test:watch</code> - run all tests in watch mode</li>
<li><code>npm run test:net</code> - launch a Ganache test chain and deploy MakerDAO&#39;s contracts on it</li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
