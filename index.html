
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#makerdao-exchange-integration" class="toc-h1 toc-link" data-title="makerdao-exchange-integration">MakerDAO Exchange Integration</a>
          </li>
          <li>
            <a href="#npm-package-setup" class="toc-h1 toc-link" data-title="npm-package-setup">NPM package setup</a>
          </li>
          <li>
            <a href="#maker" class="toc-h1 toc-link" data-title="maker">Maker</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#service" class="toc-h2 toc-link" data-title="strong-service-strong"><strong>service</strong></a>
                  </li>
                  <li>
                    <a href="#opencdp" class="toc-h2 toc-link" data-title="strong-opencdp-strong"><strong>openCdp</strong></a>
                  </li>
                  <li>
                    <a href="#getcdp" class="toc-h2 toc-link" data-title="strong-getcdp-strong"><strong>getCdp</strong></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cdp" class="toc-h1 toc-link" data-title="cdp">CDP</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getcdpid" class="toc-h2 toc-link" data-title="strong-getcdpid-strong"><strong>getCdpId</strong></a>
                  </li>
                  <li>
                    <a href="#getinfo" class="toc-h2 toc-link" data-title="strong-getinfo-strong"><strong>getInfo</strong></a>
                  </li>
                  <li>
                    <a href="#getcollateralamount" class="toc-h2 toc-link" data-title="strong-getcollateralamount-strong"><strong>getCollateralAmount</strong></a>
                  </li>
                  <li>
                    <a href="#getdebtamount" class="toc-h2 toc-link" data-title="strong-getdebtamount-strong"><strong>getDebtAmount</strong></a>
                  </li>
                  <li>
                    <a href="#locketh" class="toc-h2 toc-link" data-title="strong-locketh-strong"><strong>lockEth</strong></a>
                  </li>
                  <li>
                    <a href="#drawdai" class="toc-h2 toc-link" data-title="strong-drawdai-strong"><strong>drawDai</strong></a>
                  </li>
                  <li>
                    <a href="#wipedai" class="toc-h2 toc-link" data-title="strong-wipedai-strong"><strong>wipeDai</strong></a>
                  </li>
                  <li>
                    <a href="#freepeth" class="toc-h2 toc-link" data-title="strong-freepeth-strong"><strong>freePeth</strong></a>
                  </li>
                  <li>
                    <a href="#give" class="toc-h2 toc-link" data-title="strong-give-strong"><strong>give</strong></a>
                  </li>
                  <li>
                    <a href="#shut" class="toc-h2 toc-link" data-title="strong-shut-strong"><strong>shut</strong></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#source-code-setup" class="toc-h1 toc-link" data-title="source-code-setup">Source code setup</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#prerequisites" class="toc-h2 toc-link" data-title="prerequisites">Prerequisites</a>
                  </li>
                  <li>
                    <a href="#features" class="toc-h2 toc-link" data-title="features">Features</a>
                  </li>
                  <li>
                    <a href="#run-the-tests" class="toc-h2 toc-link" data-title="run-the-tests">Run the tests</a>
                  </li>
                  <li>
                    <a href="#inspect-contract-state" class="toc-h2 toc-link" data-title="inspect-contract-state">Inspect contract state</a>
                  </li>
                  <li>
                    <a href="#commands" class="toc-h2 toc-link" data-title="commands">Commands</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='makerdao-exchange-integration'>MakerDAO Exchange Integration</h1>
<p><a href="https://travis-ci.org/jluccisano/webpack-es6-boilerplate"><img src="http://img.shields.io/travis/jluccisano/webpack-es6-boilerplate.svg" alt="tests" /></a>
<a href="https://codecov.io/gh/jluccisano/webpack-es6-boilerplate"><img src="https://codecov.io/gh/jluccisano/webpack-es6-boilerplate/branch/master/graph/badge.svg" alt="coverage" /></a></p>

<p><strong>MakerDAO Exchange Integration</strong> is a JavaScript library that makes it easy to build applications on top of MakerDAO&#39;s platform of smart contracts. You can use Maker&#39;s contracts to open Collateralized Debt Positions, withdraw loans in Dai, trade tokens on OasisDEX, and more.</p>

<p>The library features a pluggable, service-based architecture, which allows users maximal control when integrating the Maker functionality into existing infrastructures. It also includes convenient configuration presets for out-of-the-box usability, a powerful smart contract state inspector, and support for both front-end and back-end applications.</p>

<p>Maker&#39;s entire suite of contracts will eventually be accessible through this library—including the DAO governance and the upcoming multi-collateral release—but functionality is limited in the current alpha version to the following areas:</p>

<ul>
<li>Opening and shutting CDPs</li>
<li>Locking and unlocking collateral</li>
<li>Withdrawing and repaying Dai</li>
<li>Automated token conversions</li>
<li>Token contract functionality for WETH, PETH, MKR, Dai, and ETH</li>
<li>Buying and selling MKR and Dai with built-in DEX integration</li>
</ul>
<h1 id='npm-package-setup'>NPM package setup</h1>
<p><code>npm install @makerdao/makerdao-exchange-integration</code></p>

<p>First, import the necessary modules in your JS code:</p>

<p><code>import { Maker, ConfigFactory } from &#39;@makerdao/makerdao-exchange-integration&#39;;</code></p>

<p>Then create a connected instance of the Maker class and use it to call CDP methods, like you see in the JS snippet in the right panel.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">async</span> <span class="nx">setupFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">ConfigFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'kovan'</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">await</span> <span class="k">new</span> <span class="nx">Maker</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">async</span> <span class="nx">someOtherFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">maker</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">setupFunction</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">cdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span>

  <span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">();</span>
<span class="p">}</span>
</code></pre><h1 id='maker'>Maker</h1>
<p>Once you&#39;ve connected your instance of <code>maker</code> (following the instructions in the <code>Web3Service</code> section), you can use the <code>maker</code> interface to access the core library functionality.</p>
<h2 id='service'><strong>service</strong></h2>
<ul>
<li><strong>Params:</strong> service (string)</li>
<li><strong>Returns:</strong> service object</li>
</ul>

<p>The service function can be used to access services that were injected into your instance of <code>maker</code>. The service must be in the list of available services you passed to <code>ConfigFactory</code>.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">priceFeedService</span> <span class="o">=</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'priceFeed'</span><span class="p">);</span>
</code></pre><h2 id='opencdp'><strong>openCdp</strong></h2>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to new CDP object)</li>
</ul>

<p><code>maker.openCdp()</code> will create a new CDP, and then return the CDP object, which can be used to access other CDP functionality.</p>

<p>By default, the promise will resolve when the transaction is mined.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">newCdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">openCdp</span><span class="p">();</span>
</code></pre><h2 id='getcdp'><strong>getCdp</strong></h2>
<ul>
<li><strong>Params:</strong> CDP ID (integer)</li>
<li><strong>Returns:</strong> promise (resolves to CDP object)</li>
</ul>

<p><code>maker.getCdp(id)</code> creates a CDP object for an existing CDP. The CDP object can then be used to interact with your CDP.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">cdp</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">maker</span><span class="p">.</span><span class="nx">getCdp</span><span class="p">(</span><span class="mi">614</span><span class="p">);</span>
</code></pre><h1 id='cdp'>CDP</h1>
<p>Now that you&#39;ve used <code>maker</code> to either open a new CDP or retrieve an existing one, you can use the returned <code>cdp</code> object to call functions on it.</p>
<h2 id='getcdpid'><strong>getCdpId</strong></h2>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to CDP ID)</li>
</ul>

<p>Use <code>cdp.getCdpId()</code> to retrieve the ID from a CDP object. You may need to use the ID as a parameter for other functions.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getCdpId</span><span class="p">();</span>
</code></pre><h2 id='getinfo'><strong>getInfo</strong></h2>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to CDP info object)</li>
</ul>

<p><code>cdp.getInfo()</code> will return a few distinct properties of the CDP:</p>

<ul>
<li>lad: The Ethereum address associated with the owner of the CDP</li>
<li>ink: Amount of collateral locked in the CDP</li>
<li>art: Outstanding normalized debt (tax only)</li>
<li>ire: Outstanding normalized debt</li>
</ul>

<p>Please refer to the <a href="https://makerdao.com/whitepaper/DaiDec17WP.pdf">MakerDAO White Paper</a> or reach out on our <a href="https://chat.makerdao.com/home">community chat</a> if you need help understanding how these variables are used in the system.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getInfo</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">lockedPeth</span> <span class="o">=</span> <span class="nx">info</span><span class="p">.</span><span class="nx">ink</span><span class="p">;</span>
</code></pre><h2 id='getcollateralamount'><strong>getCollateralAmount</strong></h2>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to locked amount in PETH)</li>
</ul>

<p><code>cdp.getCollateralAmount()</code> returns the amount of locked collateral in the CDP.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">lockedPeth</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getCollateralAmount</span><span class="p">();</span>
</code></pre><h2 id='getdebtamount'><strong>getDebtAmount</strong></h2>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to the amount of outstanding debt in Dai)</li>
</ul>

<p><code>cdp.getDebtAmount()</code> returns the amount of Dai that has been borrowed against the collateral in the CDP.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">daiDebt</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">getDebtAmount</span><span class="p">();</span>
</code></pre><h2 id='locketh'><strong>lockEth</strong></h2>
<ul>
<li><strong>Params:</strong> amount to lock in the CDP (in ETH, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.lockEth(eth)</code> abstracts the token conversions needed to lock collateral in a CDP. It first converts the ETH to WETH, then converts the WETH to PETH, then locks the PETH in the CDP.</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">lockEth</span><span class="p">(</span><span class="s1">'0.1'</span><span class="p">);</span>
</code></pre><h2 id='drawdai'><strong>drawDai</strong></h2>
<ul>
<li><strong>Params:</strong> amount to draw (in Dai, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.drawDai(dai)</code> withdraws the specified amount of Dai as a loan against the collateral in the CDP. As such, it will fail if the CDP doesn&#39;t have enough PETH locked in it to remain at least 150% collateralized.</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">drawDai</span><span class="p">(</span><span class="s1">'100'</span><span class="p">);</span>
</code></pre><h2 id='wipedai'><strong>wipeDai</strong></h2>
<ul>
<li><strong>Params:</strong> amount to repay (in Dai, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.wipeDai(dai)</code> sends Dai back to the CDP in order to repay some (or all) of its outstanding debt.</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">wipeDai</span><span class="p">(</span><span class="s1">'100'</span><span class="p">);</span>
</code></pre><h2 id='freepeth'><strong>freePeth</strong></h2>
<ul>
<li><strong>Params:</strong> amount to withdraw (in PETH, as string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.freePeth(peth)</code> withdraws the specified amount of PETH and returns it to the owner&#39;s address. As such, the contract will only allow you to free PETH that&#39;s locked in excess of 150% of the CDP&#39;s outstanding debt.</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">freePeth</span><span class="p">(</span><span class="s1">'0.1'</span><span class="p">);</span>
</code></pre><h2 id='give'><strong>give</strong></h2>
<ul>
<li><strong>Params:</strong> Ethereum address (string)</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.give(address)</code> transfers ownership of the CDP from the current owner to the address you provide as an argument.</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">give</span><span class="p">(</span><span class="s1">'0x046ce6b8ecb159645d3a605051ee37ba93b6efcc'</span><span class="p">);</span>
</code></pre><h2 id='shut'><strong>shut</strong></h2>
<ul>
<li><strong>Params:</strong> none</li>
<li><strong>Returns:</strong> promise (resolves to <code>transactionHybrid</code>)</li>
</ul>

<p><code>cdp.shut()</code> will close the CDP and return the collateral, in PETH, to its owner. It will fail if the CDP still has outstanding debt.</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">return</span> <span class="nx">await</span> <span class="nx">cdp</span><span class="p">.</span><span class="nx">shut</span><span class="p">();</span>
</code></pre><h1 id='source-code-setup'>Source code setup</h1>
<ol>
<li><code>git clone https://github.com/makerdao/makerdao-integration-poc</code></li>
<li><code>npm install</code></li>
</ol>
<h2 id='prerequisites'>Prerequisites</h2>
<p><a href="https://nodejs.org"><img src="https://img.shields.io/node/v/webpack-es6-boilerplate.svg" alt="node" /></a>
<a href="https://npmjs.com/"><img src="https://img.shields.io/badge/npm-5.3.0-blue.svg" alt="npm" /></a></p>

<ul>
<li><a href="http://es6-features.org">Node.js</a></li>
</ul>
<h2 id='features'>Features</h2>
<ul>
<li><a href="https://webpack.js.org/guides">Webpack</a> (v3.5.5)

<ul>
<li><a href="https://github.com/webpack/webpack-dev-server">Webpack Dev Server</a> (v2.7.1)</li>
<li><a href="https://webpack.js.org/concepts/hot-module-replacement">Hot Module Replacement</a></li>
<li><a href="https://github.com/johnagan/clean-webpack-plugin">Clean Webpack Plugin</a> (v0.1.16)</li>
</ul></li>
<li><a href="http://es6-features.org">ECMAScript 6</a></li>
<li><a href="https://babeljs.io/docs/setup/#installation">Babel</a> (v6.26.0)</li>
<li><a href="https://eslint.org/docs/user-guide/getting-started">ESLint</a> (v4.5.0)</li>
<li><a href="https://facebook.github.io/jest/docs/en/getting-started.html">Jest</a> (v20.0.4)</li>
<li><a href="http://sass-lang.com/guide">Sass</a></li>
</ul>
<h2 id='run-the-tests'>Run the tests</h2>
<p>The test suite is configured to run on a Ganache test chain. Before running the tests (<code>npm test</code>), the test chain will start, and the script will deploy all the Maker contracts to the chain.</p>

<p>To avoid waiting for this process every time you run the tests, use the command <code>npm run test:watch</code>.</p>

<p>If you want to deploy the contracts to a test chain independently from the test suite, use <code>npm run test:net</code>.</p>
<h2 id='inspect-contract-state'>Inspect contract state</h2>
<p>Start the dev server using <code>npm start</code>, then open <a href="http://localhost:9000">http://localhost:9000</a></p>
<h2 id='commands'>Commands</h2>
<ul>
<li><code>npm start</code> - start the dev server</li>
<li><code>npm run build:backend</code> - create backend build in <code>dist</code> folder</li>
<li><code>npm run build:frontend</code> - create frontend build in <code>dist</code> folder</li>
<li><code>npm run lint</code> - run an ESLint check</li>
<li><code>npm run coverage</code> - run code coverage and generate report in the <code>coverage</code> folder</li>
<li><code>npm test</code> - run all tests</li>
<li><code>npm run test:watch</code> - run all tests in watch mode</li>
<li><code>npm run test:net</code> - launch a Ganache test chain and deploy MakerDAO&#39;s contracts on it</li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
